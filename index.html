<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    html, body { margin:0; padding:0; }
    #ean { display:block; width:100%; height:100vh; background:#fff; }
    #code-text {
      position: absolute;
      left: 50%;
      bottom: 10%;
      transform: translateX(-50%);
      font-family: Arial, sans-serif;
      font-size: 16px;
      color: #58bd00;
      user-select: text;
      white-space: nowrap;
      background: rgba(255,255,255,0.8);
      padding: 2px 4px;
      border-radius: 4px;
    }
    #regen {
      position:absolute;
      top:10px; right:10px;
      z-index:10;
      padding:8px;
    }
  </style>
</head>
<body>
  <canvas id="ean"></canvas>
  <div id="code-text"></div>

  <script>
    const L = {0:"0001101",1:"0011001",2:"0010011",3:"0111101",4:"0100011",5:"0110001",
               6:"0101111",7:"0111011",8:"0110111",9:"0001011"};
    const G = {0:"0100111",1:"0110011",2:"0011011",3:"0100001",4:"0011101",5:"0111001",
               6:"0000101",7:"0010001",8:"0001001",9:"0010111"};
    const R = {0:"1110010",1:"1100110",2:"1101100",3:"1000010",4:"1011100",5:"1001110",
               6:"1010000",7:"1000100",8:"1001000",9:"1110100"};
    const parityMap = {
      0:["L","L","L","L","L","L"],1:["L","L","G","L","G","G"],2:["L","L","G","G","L","G"],
      3:["L","L","G","G","G","L"],4:["L","G","L","L","G","G"],5:["L","G","G","L","L","G"],
      6:["L","G","G","G","L","L"],7:["L","G","L","G","L","G"],8:["L","G","L","G","G","L"],
      9:["L","G","G","L","G","L"]
    };

    function calcChecksum(code12) {
      let sum = 0;
      for (let i = 0; i < 12; i++) {
        const d = +code12[i];
        sum += d * (i % 2 === 0 ? 1 : 3);
      }
      return (10 - (sum % 10)) % 10;
    }

    function drawEAN() {
  const now = new Date();

  // 1) Generar un número aleatorio entre 1 y 10
  const resta = Math.floor(Math.random() * 10) + 1;

  // 2) Extraer y ajustar horas y minutos
  let horas = now.getHours();
  let minutos = now.getMinutes() - resta;

  // 3) Normalizar cruce de hora
  if (minutos < 0) {
    minutos += 60;
    horas = (horas - 1 + 24) % 24;
  }

  // 4) Formatear con dos dígitos
  const hh = String(horas).padStart(2, "0");
  const mi = String(minutos).padStart(2, "0");

  // 5) El resto igual que antes
  const mm = String(now.getMonth() + 1).padStart(2, "0");
  const dd = String(now.getDate()).padStart(2, "0");
  const base12 = `2400${mm}${dd}${hh}${mi}`;
  const check = calcChecksum(base12);
  const code13 = base12 + check;

  const canvas = document.getElementById("ean"),
        cw = canvas.clientWidth,
        ch = canvas.clientHeight;
  canvas.width  = cw * devicePixelRatio;
  canvas.height = ch * devicePixelRatio;
  const ctx = canvas.getContext("2d");
  ctx.scale(devicePixelRatio, devicePixelRatio);
  ctx.clearRect(0, 0, cw, ch);

  // Generar patrón
  let pat = "101";
  const first = +code13[0],
        left = code13.slice(1,7),
        right = code13.slice(7);
  parityMap[first].forEach((p,i) =>
    pat += (p === "L" ? L[left[i]] : G[left[i]])
  );
  pat += "01010";
  right.split("").forEach(d => pat += R[d]);
  pat += "101";

  // Dibujar barras con margen
  const margin = cw * 0.05,
        usableWidth = cw - 2 * margin,
        barW = usableWidth / 95,
        barH = ch * 0.8;
  ctx.fillStyle = "#000";
  pat.split("").forEach((bit,i) => {
    if (bit === "1") {
      ctx.fillRect(margin + i * barW, 0, barW, barH);
    }
  });

  // Actualizar texto seleccionable
  document.getElementById("code-text").textContent = code13;

  // Fullscreen toggling
  canvas.onclick = () => {
    if (document.fullscreenElement) document.exitFullscreen();
    else canvas.requestFullscreen();
  };
}


   
    window.onload = drawEAN;
  </script>
</body>
</html>
